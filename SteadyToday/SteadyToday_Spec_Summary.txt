꾸준한오늘 – 기획/설계 합의 정리 (대화 요약)
=========================================

0) 서비스 한 줄
- 만다라트(연간 목표→카테고리→액션)로 목표를 "액션"으로 쪼개고,
  오늘은 액션을 체크(성공/미기록)하고, 오늘의 도전 액션(연속 시간 기록)도 관리하는 iOS 앱.
  [구현 완료: SwiftUI + SwiftData 기반]

1) 핵심 문구(App Copy)
- 슬로건: 하루가 모여 나를 만든다 — 그래서 오늘은 '액션'부터
- 소개(톤: 담백+위트 한 스푼):
  - 꾸준한오늘은 목표를 "액션"으로 바꾸는 앱이에요.
  - 만다라트로 연간 목표를 카테고리와 액션으로 쪼개고, 오늘은 그 액션을 체크만 하면 됩니다.
  - 하루의 액션이 쌓이면, 어느새 목표에 도착해요. (진짜로요.)

2) 만다라트 구조(제약)
- 연간 목표: "연도별 1개"
  - 예: 2026 목표 1개, 2027 목표 1개
  - 새해에 전년도 계획 복사 기능은 MVP에 없음(새로 계획 세움)
- 카테고리: 최대 8개
  - 카테고리 설정 시 "색상(colorKey)" 지정 (12가지 프리셋 색상)
  - Today/리스트에서 액션 앞에 색상 동그라미로 표시
- 액션: 카테고리별 최대 8개

3) 액션 타입 & 체크 규칙(중요)
3-1) 액션 타입 3가지
- 위클리(주 N회)
  - 요일 제한 없음(그냥 그 주에 N회만 하면 됨)
  - 주 시작 요일: 월요일(월~일 기준)
  - 체크는 "오늘 날짜로 1회 성공" 기록
  - 하루에 여러 번 했어도: 하루 1회 성공(=1 카운트)만 인정
- 데일리(요일 반복)
  - 액션 생성 시 월/화/수/목/금/토/일을 복수 선택하여 반복
  - 선택된 요일에 해당하는 날만 "오늘 해야 할 일"로 노출(기본 정책)
  - 하루에 성공 1번이면 완료(하루 1회)
- 오늘의 도전(Time-based)
  - 매일 N시간 목표, 요일 반복은 자동으로 월~일 전체로 설정
  - 기록 방식: 타이머 모드만 사용 (수동 입력 제거)
  - 하루에 하나의 액션만 존재 (시작 전 / 진행 중 / 완료)
  - 시작 날짜와 종료 날짜를 기준으로 관리
  - 어제 시작한 진행 중인 세션이 있으면 오늘에도 표시됨
  - 귀속 날짜: 시작한 날짜 기준 (종료 처리 시에도 시작 날짜로 기록, 완료율 집계도 시작 날짜 기준)

3-2) 체크 UX(액션)
- MVP에서 실패 버튼 없음
- 상태는 "미기록 ↔ 성공" 토글만
  - 기본: 미기록(회색이지만 탭 가능)
  - 1회 탭: 성공 기록
  - 2회 탭(다시): 기록 취소 → 미기록으로 복귀
- "미기록이 곧 실패(또는 미달성)"로 해석 가능(통계/리포트는 2차)

4) 오늘의 도전(Time-based) 규칙
- 단식은 제거하고 "오늘의 도전 액션"으로 통합
- 매일 N시간 목표, 요일 반복은 자동으로 월~일 전체로 설정
- 기록 방식: 타이머만 사용 (수동 입력 제거)
- 하루에 하나의 액션만 존재
  - 시작 전: 시작 가능한 상태
  - 진행 중: 어제 시작한 세션도 오늘 표시됨
  - 완료: 오늘 시작해서 완료된 세션만 완료 카드로 표시
- 귀속 기준:
  - 시작 날짜 기준으로 기록 (종료 처리 시에도 시작 날짜 유지)
  - 완료율 집계도 시작 날짜 기준

5) 화면/IA(탭 구성) – iOS 기본 앱처럼 심플
- Tab 3개:
  1) Today(오늘) [구현 완료]
     - "이번 주 목표" 섹션: 위클리 액션들, 진행도 x/N 표시
     - "오늘의 도전" 섹션: 가로 스크롤 카드 형태, 시작/진행 중/완료 상태 표시
     - "오늘의 액션" 섹션: 데일리 액션들(오늘 요일만)
     - Edit 모드: 드래그로 액션 순서 변경(전역 todayOrder 저장)
  2) Mandalart(만다라트) [구현 완료]
     - 연간 목표 텍스트 수정
     - 카테고리 생성·편집(이름 + 색상 선택)
     - 액션 생성·편집(위클리/데일리/오늘의 도전, 오늘의 도전은 목표 시간만 설정)
     - 활성화 기간 설정: 시작 날짜/종료 날짜 선택 가능(선택사항, 설정 시 해당 기간에만 액션 활성화)
  3) History(기록) [구현 완료]
     - 캘린더 뷰: 월별 캘린더, 날짜별 달성률(%) 표시(데일리+위클리+오늘의 도전 전체 기준)
     - 날짜별 상세 기록: 요약/상세 탭으로 구분
       - 요약 탭: 전체 달성률 카드 + 카테고리별 달성 현황 그리드
       - 상세 탭: 데일리/위클리/오늘의 도전 성공 기록 (체크표시 없음)
     - 스와이프 제스처: 좌우 스와이프로 날짜 이동, 월 경계 자동 변경

6) 정렬 정책 [구현 완료]
- Today에서 Edit 모드로 드래그하여 액션 순서 변경 가능
- "전역 todayOrder"로 저장(모든 액션에 대해 통합 정렬)
- 카테고리 내 정렬은 categoryOrder로 별도 관리

7) 성공률 대시보드(월간 %) 관련 결정
- 처음에는 "카테고리 월간 달성률(%)"을 설계하려 했으나,
  월 경계(주가 달을 걸치는 문제)에서 귀속/분모 정의가 복잡해짐.
- 사용자의 판단: A안(월요일 귀속)의 단점이 크리티컬 → MVP에서 "성공률 대시보드"는 제외하고,
  나중에 자세히 재설계.

8) 데이터 모델(구현 완료 - SwiftData)
- PlanYear / MandalartCategory / RoutineAction / ActionCheck / TimeSession
  - PlanYear: year, goalTitle, categories
  - MandalartCategory: name, colorKey(색상 키), sortOrder, actions
  - RoutineAction:
    - 타입: weeklyN / weekdayRepeat / timeBased
    - weeklyN: weeklyTargetN(목표 N)
    - weekdayRepeat: repeatWeekdays(비트마스크)
    - timeBased: timeRecordMode(timer로 고정), timeTargetMinutes, repeatWeekdays(자동으로 월~일 전체)
    - 활성화: isActive(Bool), startDate(활성화 시작 날짜, 선택), endDate(활성화 종료 날짜, 선택)
    - 정렬: todayOrder(전역), categoryOrder(카테고리 내)
    - 날짜별 활성화 체크: isActive(on:calendar:) 헬퍼 메서드로 isActive + 활성화 기간 통합 체크
  - ActionCheck:
    - day(startOfDay), createdAt, action
    - 데일리/위클리 모두 동일 모델, day 기준으로 집계
  - TimeSession:
    - attributedDay(시작 날짜 기준), durationMinutes, startAt, endAt, isManual(false로 고정), action
    - 타이머만 사용: startAt/endAt으로 시간 계산, 종료 시 시작 날짜로 기록

9) MVP 범위(구현 상태)
✅ 만다라트 구조(연간 1 목표/카테고리 8/액션 8) + 카테고리 색상
✅ 액션 생성: 위클리(주 N회) / 데일리(요일 반복) / 오늘의 도전
✅ Today 체크: 성공/미기록 토글, Edit 모드 드래그 정렬
✅ 오늘의 도전 액션: 타이머 모드만 사용(시작/종료), 목표 시간 설정, 가로 스크롤 카드 UI
✅ History: 캘린더 뷰 + 날짜별 상세 기록 로그(요약/상세 탭, 데일리+위클리+오늘의 도전 전체 달성률 계산)
✅ 액션 활성화 기간: startDate/endDate로 액션 활성화 기간 설정 가능, 날짜별 활성화 체크 로직 적용
⏸️ 단식 기능: 제거됨(오늘의 도전 액션으로 통합)
⏸️ Edit 모드 UI: 시스템 Edit 모드에 의존(추후 Edit 버튼 추가 가능)
